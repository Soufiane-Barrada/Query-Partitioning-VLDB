SELECT COALESCE("MOVIE_ID", "MOVIE_ID") AS "MOVIE_ID", "TITLE", "PRODUCTION_YEAR", "KEYWORDS", "COMPANIES", "ACTORS", "ERA", "ACTOR_COUNT"
FROM (SELECT "MOVIE_ID", "TITLE", "PRODUCTION_YEAR", "KEYWORDS", "COMPANIES", "ACTORS", "ERA", COUNT(DISTINCT "ACTORS") AS "ACTOR_COUNT"
FROM (SELECT ANY_VALUE("id10") AS "MOVIE_ID", "title" AS "TITLE", "production_year" AS "PRODUCTION_YEAR", ARRAY_AGG(DISTINCT "keyword") AS "KEYWORDS", ARRAY_AGG(DISTINCT "name") AS "COMPANIES", ARRAY_AGG(DISTINCT "name0") AS "ACTORS", CASE WHEN "production_year" < 2000 THEN 'Classic' WHEN "production_year" >= 2000 AND "production_year" <= 2010 THEN 'Modern ' ELSE 'Recent ' END AS "ERA"
FROM "s1"
GROUP BY "id10", "title", "production_year") AS "t2"
GROUP BY "MOVIE_ID", "TITLE", "PRODUCTION_YEAR", "KEYWORDS", "COMPANIES", "ACTORS", "ERA"
ORDER BY "PRODUCTION_YEAR" DESC NULLS FIRST, 8 DESC NULLS FIRST) AS "t4"