SELECT COALESCE("t7"."USERID", "t7"."USERID") AS "USERID", "t7"."DISPLAYNAME", "t7"."POSTCOUNT", "t7"."TOTALVIEWS", "t7"."AVERAGESCORE", "t7"."GOLDBADGES", "t7"."SILVERBADGES", "t7"."BRONZEBADGES", "t7"."ACTIVITYLEVEL"
FROM (SELECT "t2"."Id" AS "USERID", "t2"."DisplayName" AS "DISPLAYNAME", CASE WHEN "t2"."POSTCOUNT" IS NOT NULL THEN CAST("t2"."POSTCOUNT" AS BIGINT) ELSE 0 END AS "POSTCOUNT", CASE WHEN "t2"."TOTALVIEWS" IS NOT NULL THEN CAST("t2"."TOTALVIEWS" AS INTEGER) ELSE 0 END AS "TOTALVIEWS", CASE WHEN "t2"."AVERAGESCORE" IS NOT NULL THEN CAST("t2"."AVERAGESCORE" AS INTEGER) ELSE 0 END AS "AVERAGESCORE", CASE WHEN "t5"."GOLDBADGES" IS NOT NULL THEN CAST("t5"."GOLDBADGES" AS INTEGER) ELSE 0 END AS "GOLDBADGES", CASE WHEN "t5"."SILVERBADGES" IS NOT NULL THEN CAST("t5"."SILVERBADGES" AS INTEGER) ELSE 0 END AS "SILVERBADGES", CASE WHEN "t5"."BRONZEBADGES" IS NOT NULL THEN CAST("t5"."BRONZEBADGES" AS INTEGER) ELSE 0 END AS "BRONZEBADGES", CASE WHEN CASE WHEN "t2"."POSTCOUNT" IS NOT NULL THEN CAST("t2"."POSTCOUNT" AS BIGINT) ELSE 0 END > 50 THEN 'Highly Active    ' WHEN CASE WHEN "t2"."POSTCOUNT" IS NOT NULL THEN CAST("t2"."POSTCOUNT" AS BIGINT) ELSE 0 END >= 21 AND CASE WHEN "t2"."POSTCOUNT" IS NOT NULL THEN CAST("t2"."POSTCOUNT" AS BIGINT) ELSE 0 END <= 50 THEN 'Moderately Active' ELSE 'Less Active      ' END AS "ACTIVITYLEVEL"
FROM (SELECT *
FROM "STACK"."Users"
LEFT JOIN "s1" ON "Users"."Id" = "s1"."OwnerUserId"
WHERE CASE WHEN "s1"."TOTALVIEWS" IS NOT NULL THEN CAST("s1"."TOTALVIEWS" AS INTEGER) ELSE 0 END > 1000) AS "t2"
LEFT JOIN (SELECT ANY_VALUE("Users0"."Id") AS "USERID", "Users0"."DisplayName" AS "DISPLAYNAME", SUM(CASE WHEN CAST("Badges"."Class" AS INTEGER) = 1 THEN 1 ELSE 0 END) AS "GOLDBADGES", SUM(CASE WHEN CAST("Badges"."Class" AS INTEGER) = 2 THEN 1 ELSE 0 END) AS "SILVERBADGES", SUM(CASE WHEN CAST("Badges"."Class" AS INTEGER) = 3 THEN 1 ELSE 0 END) AS "BRONZEBADGES"
FROM "STACK"."Badges"
RIGHT JOIN "STACK"."Users" AS "Users0" ON "Badges"."UserId" = "Users0"."Id"
GROUP BY "Users0"."Id", "Users0"."DisplayName") AS "t5" ON "t2"."Id" = "t5"."USERID"
ORDER BY 4 DESC NULLS FIRST) AS "t7"