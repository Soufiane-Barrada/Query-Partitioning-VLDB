SELECT COALESCE("t6"."USERID", "t6"."USERID") AS "USERID", "t6"."REPUTATION", "t6"."POSTCOUNT", "t6"."QUESTIONCOUNT", "t6"."ANSWERCOUNT", "t6"."LASTPOSTDATE", "t6"."AVERAGECOMMENTSCORE", "t6"."POSTID", "t6"."TITLE", "t6"."CREATIONDATE", "t6"."VIEWCOUNT", "t6"."SCORE", "t6"."ANSWERCOUNT0", "t6"."COMMENTCOUNT", "t6"."POSTTYPENAME"
FROM (SELECT "t4"."USERID", "t4"."REPUTATION", "t4"."POSTCOUNT", "t4"."QUESTIONCOUNT", "t4"."ANSWERCOUNT", "t4"."LASTPOSTDATE", "t4"."AVERAGECOMMENTSCORE", "t1"."POSTID", "t1"."TITLE", "t1"."CREATIONDATE", "t1"."VIEWCOUNT", "t1"."SCORE", "t1"."ANSWERCOUNT" AS "ANSWERCOUNT0", "t1"."COMMENTCOUNT", "t1"."POSTTYPENAME"
FROM (SELECT "Posts0"."Id" AS "POSTID", "Posts0"."Title" AS "TITLE", "Posts0"."CreationDate" AS "CREATIONDATE", "Posts0"."ViewCount" AS "VIEWCOUNT", "Posts0"."Score" AS "SCORE", "Posts0"."AnswerCount" AS "ANSWERCOUNT", "Posts0"."CommentCount" AS "COMMENTCOUNT", "PostTypes"."Name" AS "POSTTYPENAME", "Posts0"."OwnerUserId" AS "OWNERUSERID"
FROM "STACK"."PostTypes"
INNER JOIN "STACK"."Posts" AS "Posts0" ON "PostTypes"."Id" = "Posts0"."PostTypeId") AS "t1"
RIGHT JOIN (SELECT ANY_VALUE("s1"."Id") AS "USERID", "s1"."Reputation" AS "REPUTATION", COUNT("s1"."Id0") AS "POSTCOUNT", SUM(CASE WHEN CAST("s1"."PostTypeId" AS INTEGER) = 1 THEN 1 ELSE 0 END) AS "QUESTIONCOUNT", SUM(CASE WHEN CAST("s1"."PostTypeId" AS INTEGER) = 2 THEN 1 ELSE 0 END) AS "ANSWERCOUNT", MAX("s1"."CreationDate0") AS "LASTPOSTDATE", AVG(CASE WHEN "Comments"."Score" IS NOT NULL THEN CAST("Comments"."Score" AS INTEGER) ELSE 0 END) AS "AVERAGECOMMENTSCORE"
FROM "STACK"."Comments"
RIGHT JOIN "s1" ON "Comments"."PostId" = "s1"."Id0"
GROUP BY "s1"."Id", "s1"."Reputation") AS "t4" ON "t1"."OWNERUSERID" = "t4"."USERID"
ORDER BY "t4"."REPUTATION" DESC NULLS FIRST, "t1"."VIEWCOUNT" DESC NULLS FIRST) AS "t6"