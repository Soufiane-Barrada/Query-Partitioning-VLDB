SELECT COALESCE("t2"."POSTTYPE", "t2"."POSTTYPE") AS "POSTTYPE", "t2"."TOTALPOSTS", "t2"."$f3" AS "TOTALSCORE", "t2"."$f4" AS "TOTALVIEWS", "t2"."$f5" AS "TOTALUPVOTES", "t2"."$f6" AS "TOTALDOWNVOTES", ROUND(CAST("t2"."$f3" AS DECIMAL(12, 1)) / CASE WHEN "t2"."TOTALPOSTS" = 0 THEN NULL ELSE "t2"."TOTALPOSTS" END, 2) AS "AVGSCOREPERPOST", ROUND(CAST("t2"."$f4" AS DECIMAL(12, 1)) / CASE WHEN "t2"."TOTALPOSTS" = 0 THEN NULL ELSE "t2"."TOTALPOSTS" END, 2) AS "AVGVIEWSPERPOST"
FROM (SELECT "s1"."Name", ANY_VALUE("s1"."Name") AS "POSTTYPE", COUNT(*) AS "TOTALPOSTS", SUM("s1"."Score") AS "$f3", SUM("s1"."ViewCount") AS "$f4", SUM(CASE WHEN CAST("Votes"."VoteTypeId" AS INTEGER) = 2 THEN 1 ELSE 0 END) AS "$f5", SUM(CASE WHEN CAST("Votes"."VoteTypeId" AS INTEGER) = 3 THEN 1 ELSE 0 END) AS "$f6"
FROM "STACK"."Votes"
RIGHT JOIN "s1" ON "Votes"."PostId" = "s1"."Id"
GROUP BY "s1"."Name"
ORDER BY 3 DESC NULLS FIRST) AS "t2"