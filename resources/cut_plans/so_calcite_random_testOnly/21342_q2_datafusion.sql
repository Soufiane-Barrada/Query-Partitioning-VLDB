SELECT COALESCE("t9"."DISPLAYNAME", "t9"."DISPLAYNAME") AS "DISPLAYNAME", "t9"."BADGECOUNT", "t9"."POSTCOUNT", "t9"."QUESTIONCOUNT", "t9"."ANSWERCOUNT", "t9"."TOTALVOTES", "t9"."UPVOTES", "t9"."DOWNVOTES", "t9"."USERACTIVITYSTATUS", "t9"."SUMMARY"
FROM (SELECT "t5"."DisplayName" AS "DISPLAYNAME", CASE WHEN "t5"."BADGECOUNT" IS NOT NULL THEN CAST("t5"."BADGECOUNT" AS BIGINT) ELSE 0 END AS "BADGECOUNT", CASE WHEN "t5"."POSTCOUNT" IS NOT NULL THEN CAST("t5"."POSTCOUNT" AS BIGINT) ELSE 0 END AS "POSTCOUNT", CASE WHEN "t5"."QUESTIONCOUNT" IS NOT NULL THEN CAST("t5"."QUESTIONCOUNT" AS INTEGER) ELSE 0 END AS "QUESTIONCOUNT", CASE WHEN "t5"."ANSWERCOUNT" IS NOT NULL THEN CAST("t5"."ANSWERCOUNT" AS INTEGER) ELSE 0 END AS "ANSWERCOUNT", CASE WHEN "t7"."TOTALVOTES" IS NOT NULL THEN CAST("t7"."TOTALVOTES" AS BIGINT) ELSE 0 END AS "TOTALVOTES", CASE WHEN "t7"."UPVOTES" IS NOT NULL THEN CAST("t7"."UPVOTES" AS INTEGER) ELSE 0 END AS "UPVOTES", CASE WHEN "t7"."DOWNVOTES" IS NOT NULL THEN CAST("t7"."DOWNVOTES" AS INTEGER) ELSE 0 END AS "DOWNVOTES", CASE WHEN CASE WHEN "t5"."FIRSTPOSTDATE" IS NOT NULL THEN CAST("t5"."FIRSTPOSTDATE" AS TIMESTAMP(0)) > (TIMESTAMP '2024-10-01 12:34:56' - INTERVAL '1' YEAR) ELSE TIMESTAMP '2024-10-01 12:34:56' > (TIMESTAMP '2024-10-01 12:34:56' - INTERVAL '1' YEAR) END THEN 'Active  ' ELSE 'Inactive' END AS "USERACTIVITYSTATUS", CONCAT('User: ', "t5"."DisplayName", '; Badges: ', CAST(CASE WHEN "t5"."BADGECOUNT" IS NOT NULL THEN CAST("t5"."BADGECOUNT" AS BIGINT) ELSE 0 END AS VARCHAR CHARACTER SET "ISO-8859-1"), '; Posts: ', CAST(CASE WHEN "t5"."POSTCOUNT" IS NOT NULL THEN CAST("t5"."POSTCOUNT" AS BIGINT) ELSE 0 END AS VARCHAR CHARACTER SET "ISO-8859-1"), '; Questions: ', CAST(CASE WHEN "t5"."QUESTIONCOUNT" IS NOT NULL THEN CAST("t5"."QUESTIONCOUNT" AS INTEGER) ELSE 0 END AS VARCHAR CHARACTER SET "ISO-8859-1"), '; Answers: ', CAST(CASE WHEN "t5"."ANSWERCOUNT" IS NOT NULL THEN CAST("t5"."ANSWERCOUNT" AS INTEGER) ELSE 0 END AS VARCHAR CHARACTER SET "ISO-8859-1"), '; Votes: ', CAST(CASE WHEN "t7"."TOTALVOTES" IS NOT NULL THEN CAST("t7"."TOTALVOTES" AS BIGINT) ELSE 0 END AS VARCHAR CHARACTER SET "ISO-8859-1")) AS "SUMMARY"
FROM (SELECT *
FROM "STACK"."Users" AS "Users0"
LEFT JOIN "s1" ON "Users0"."Id" = "s1"."USERID"
LEFT JOIN (SELECT "OwnerUserId" AS "OWNERUSERID", COUNT(*) AS "POSTCOUNT", SUM(CASE WHEN CAST("PostTypeId" AS INTEGER) = 1 THEN 1 ELSE 0 END) AS "QUESTIONCOUNT", SUM(CASE WHEN CAST("PostTypeId" AS INTEGER) = 2 THEN 1 ELSE 0 END) AS "ANSWERCOUNT", AVG("Score") AS "AVERAGESCORE", MAX("ViewCount") AS "MAXVIEWS", MIN("CreationDate") AS "FIRSTPOSTDATE"
FROM "STACK"."Posts"
GROUP BY "OwnerUserId") AS "t4" ON "Users0"."Id" = "t4"."OWNERUSERID"
WHERE "s1"."BADGECOUNT" > 0 OR "t4"."POSTCOUNT" > 0) AS "t5"
LEFT JOIN (SELECT "UserId" AS "USERID", COUNT(*) AS "TOTALVOTES", SUM(CASE WHEN CAST("VoteTypeId" AS INTEGER) = 2 THEN 1 ELSE 0 END) AS "UPVOTES", SUM(CASE WHEN CAST("VoteTypeId" AS INTEGER) = 3 THEN 1 ELSE 0 END) AS "DOWNVOTES"
FROM "STACK"."Votes"
GROUP BY "UserId") AS "t7" ON "t5"."Id" = "t7"."USERID"
ORDER BY 2 DESC NULLS FIRST, 3 DESC, 6 DESC NULLS FIRST) AS "t9"