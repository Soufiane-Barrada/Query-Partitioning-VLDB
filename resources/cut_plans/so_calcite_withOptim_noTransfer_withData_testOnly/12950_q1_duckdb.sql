SELECT COALESCE("t"."PostId", "t"."PostId") AS "POSTID", "t"."HISTORYACTIONCOUNT", "t"."LASTACTIVITYDATE", "t4"."POSTID" AS "POSTID0", "t4"."TITLE", "t4"."CREATIONDATE", "t4"."SCORE", "t4"."VIEWCOUNT", "t4"."COMMENTCOUNT", "t4"."VOTECOUNT", "t4"."BADGECOUNT", "t4"."TAGS"
FROM (SELECT "PostId", COUNT(*) AS "HISTORYACTIONCOUNT", MAX("CreationDate") AS "LASTACTIVITYDATE"
FROM "STACK"."PostHistory"
GROUP BY "PostId") AS "t"
RIGHT JOIN (SELECT ANY_VALUE("t1"."Id") AS "POSTID", "t1"."Title" AS "TITLE", "t1"."CreationDate" AS "CREATIONDATE", "t1"."Score" AS "SCORE", "t1"."ViewCount" AS "VIEWCOUNT", COUNT("t1"."Id0") AS "COMMENTCOUNT", COUNT(DISTINCT "t1"."UserId0") AS "VOTECOUNT", COUNT(DISTINCT CASE WHEN "Badges"."Id" IS NOT NULL THEN "Badges"."Id" ELSE NULL END) AS "BADGECOUNT", ARRAY_AGG(DISTINCT "Tags"."TagName") AS "TAGS"
FROM (SELECT "t0"."Id", "t0"."PostTypeId", "t0"."AcceptedAnswerId", "t0"."ParentId", "t0"."CreationDate", "t0"."Score", "t0"."ViewCount", "t0"."Body", "t0"."OwnerUserId", "t0"."OwnerDisplayName", "t0"."LastEditorUserId", "t0"."LastEditorDisplayName", "t0"."LastEditDate", "t0"."LastActivityDate", "t0"."Title", "t0"."Tags", "t0"."AnswerCount", "t0"."CommentCount", "t0"."FavoriteCount", "t0"."ClosedDate", "t0"."CommunityOwnedDate", "t0"."ContentLicense", "t0"."Id0", "t0"."PostId", "t0"."Score0", "t0"."Text", "t0"."CreationDate0", "t0"."UserDisplayName", "t0"."UserId", "t0"."ContentLicense0", "Votes"."Id" AS "Id1", "Votes"."PostId" AS "PostId0", "Votes"."VoteTypeId", "Votes"."UserId" AS "UserId0", "Votes"."CreationDate" AS "CreationDate1", "Votes"."BountyAmount"
FROM "STACK"."Votes"
RIGHT JOIN (SELECT "Posts"."Id", "Posts"."PostTypeId", "Posts"."AcceptedAnswerId", "Posts"."ParentId", "Posts"."CreationDate", "Posts"."Score", "Posts"."ViewCount", "Posts"."Body", "Posts"."OwnerUserId", "Posts"."OwnerDisplayName", "Posts"."LastEditorUserId", "Posts"."LastEditorDisplayName", "Posts"."LastEditDate", "Posts"."LastActivityDate", "Posts"."Title", "Posts"."Tags", "Posts"."AnswerCount", "Posts"."CommentCount", "Posts"."FavoriteCount", "Posts"."ClosedDate", "Posts"."CommunityOwnedDate", "Posts"."ContentLicense", "Comments"."Id" AS "Id0", "Comments"."PostId", "Comments"."Score" AS "Score0", "Comments"."Text", "Comments"."CreationDate" AS "CreationDate0", "Comments"."UserDisplayName", "Comments"."UserId", "Comments"."ContentLicense" AS "ContentLicense0"
FROM "STACK"."Comments"
RIGHT JOIN "STACK"."Posts" ON "Comments"."PostId" = "Posts"."Id") AS "t0" ON "Votes"."PostId" = "t0"."Id") AS "t1"
LEFT JOIN "STACK"."Badges" ON "t1"."OwnerUserId" = "Badges"."UserId"
LEFT JOIN "STACK"."Tags" ON "t1"."Id" = "Tags"."ExcerptPostId"
GROUP BY "t1"."Id", "t1"."Title", "t1"."CreationDate", "t1"."Score", "t1"."ViewCount") AS "t4" ON "t"."PostId" = "t4"."POSTID"