SELECT COALESCE("t9"."TITLE", "t9"."TITLE") AS "TITLE", "t9"."PRODUCTION_YEAR", "t9"."ACTOR_COUNT", "t9"."COMPANY_COUNT", "t9"."ACTOR_TITLES", "t9"."LISTED_COMPANIES"
FROM (SELECT "t7"."TITLE", "t7"."PRODUCTION_YEAR", CASE WHEN "t7"."MOVIE_COUNT" IS NOT NULL THEN CAST("t7"."MOVIE_COUNT" AS BIGINT) ELSE 0 END AS "ACTOR_COUNT", CASE WHEN "t5"."COMPANY_COUNT" IS NOT NULL THEN CAST("t5"."COMPANY_COUNT" AS BIGINT) ELSE 0 END AS "COMPANY_COUNT", CASE WHEN "t7"."MOVIE_COUNT" IS NULL THEN 'No Actors' ELSE "t7"."MOVIE_TITLES" END AS "ACTOR_TITLES", CASE WHEN "t5"."COMPANY_COUNT" IS NULL THEN 'No Companies' ELSE "t5"."COMPANY_NAMES" END AS "LISTED_COMPANIES"
FROM (SELECT "movie_companies"."movie_id" AS "MOVIE_ID", COUNT(DISTINCT "company_name"."id") AS "COMPANY_COUNT", LISTAGG(DISTINCT "company_name"."name", ', ') AS "COMPANY_NAMES"
FROM "IMDB"."company_name"
INNER JOIN "IMDB"."movie_companies" ON "company_name"."id" = "movie_companies"."company_id"
GROUP BY "movie_companies"."movie_id") AS "t5"
RIGHT JOIN (SELECT "t6"."MOVIE_ID", "t6"."TITLE", "t6"."PRODUCTION_YEAR", "t6"."RAN", "s1"."PERSON_ID", "s1"."NAME", "s1"."MOVIE_COUNT", "s1"."MOVIE_TITLES"
FROM "s1"
RIGHT JOIN (SELECT "id" AS "MOVIE_ID", "title" AS "TITLE", "production_year" AS "PRODUCTION_YEAR", ROW_NUMBER() OVER (PARTITION BY "production_year" ORDER BY "id") AS "RAN", CAST("id" AS BIGINT) AS "id"
FROM "IMDB"."aka_title") AS "t6" ON "s1"."MOVIE_COUNT" = "t6"."id") AS "t7" ON "t5"."MOVIE_ID" = "t7"."MOVIE_ID"
ORDER BY "t7"."PRODUCTION_YEAR" DESC NULLS FIRST, "t7"."TITLE") AS "t9"