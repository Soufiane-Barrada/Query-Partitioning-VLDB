SELECT COALESCE("t10"."MOVIE_ID", "t10"."MOVIE_ID") AS "MOVIE_ID", "t10"."MOVIE_TITLE", "t10"."PRODUCTION_YEAR", "t10"."CAST_COUNT", "t10"."ACTOR_NAMES", "t10"."KEYWORDS", "t10"."COMPANIES"
FROM (SELECT "s1"."MOVIE_ID", "s1"."MOVIE_TITLE", "s1"."PRODUCTION_YEAR", "s1"."CAST_COUNT", "s1"."ACTOR_NAMES", CASE WHEN "s1"."KEYWORDS" IS NOT NULL THEN CAST("s1"."KEYWORDS" AS VARCHAR CHARACTER SET "ISO-8859-1") ELSE 'No keywords' END AS "KEYWORDS", CASE WHEN "t8"."COMPANIES" IS NOT NULL THEN CAST("t8"."COMPANIES" AS VARCHAR CHARACTER SET "ISO-8859-1") ELSE 'No companies listed' END AS "COMPANIES"
FROM (SELECT "movie_companies"."movie_id" AS "MOVIE_ID", LISTAGG(DISTINCT "company_name"."name", ', ') AS "COMPANIES"
FROM "IMDB"."company_name"
INNER JOIN "IMDB"."movie_companies" ON "company_name"."id" = "movie_companies"."company_id"
GROUP BY "movie_companies"."movie_id") AS "t8"
RIGHT JOIN "s1" ON "t8"."MOVIE_ID" = "s1"."MOVIE_ID"
ORDER BY "s1"."PRODUCTION_YEAR" DESC NULLS FIRST, "s1"."CAST_COUNT" DESC NULLS FIRST) AS "t10"