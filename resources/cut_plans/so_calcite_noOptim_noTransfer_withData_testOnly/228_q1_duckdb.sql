SELECT COALESCE("t5"."DISPLAYNAME", "t5"."DISPLAYNAME") AS "DISPLAYNAME", "t5"."REPUTATIONLEVEL", "t5"."TOTALPOSTS", "t5"."TOTALQUESTIONS", "t5"."TOTALANSWERS", CASE WHEN "t7"."UPVOTES" IS NOT NULL THEN CAST("t7"."UPVOTES" AS BIGINT) ELSE 0 END AS "RECENTUPVOTES", CASE WHEN "t10"."CLOSEVOTES" IS NOT NULL THEN CAST("t10"."CLOSEVOTES" AS BIGINT) ELSE 0 END AS "RECENTCLOSEVOTES"
FROM (SELECT "t"."DISPLAYNAME", "t"."REPUTATIONLEVEL", "t1"."TOTALPOSTS", "t1"."TOTALQUESTIONS", "t1"."TOTALANSWERS", "t3"."LASTACTIVITYDATE", "t"."ID" AS "OWNERUSERID"
FROM (SELECT "Id" AS "ID", "DisplayName" AS "DISPLAYNAME", "Reputation" AS "REPUTATION", CASE WHEN "Reputation" >= 1000 THEN 'High  ' WHEN "Reputation" >= 100 THEN 'Medium' ELSE 'Low   ' END AS "REPUTATIONLEVEL"
FROM "STACK"."Users") AS "t"
INNER JOIN (SELECT "OwnerUserId" AS "OWNERUSERID", COUNT(*) AS "TOTALPOSTS", SUM(CASE WHEN CAST("PostTypeId" AS INTEGER) = 1 THEN 1 ELSE 0 END) AS "TOTALQUESTIONS", SUM(CASE WHEN CAST("PostTypeId" AS INTEGER) = 2 THEN 1 ELSE 0 END) AS "TOTALANSWERS"
FROM "STACK"."Posts"
GROUP BY "OwnerUserId") AS "t1" ON "t"."ID" = "t1"."OWNERUSERID"
INNER JOIN (SELECT "OwnerUserId" AS "OWNERUSERID", MAX("LastActivityDate") AS "LASTACTIVITYDATE"
FROM "STACK"."Posts"
GROUP BY "OwnerUserId") AS "t3" ON "t"."ID" = "t3"."OWNERUSERID"
WHERE "t"."REPUTATIONLEVEL" = 'High' AND "t1"."TOTALPOSTS" > 5 AND "t3"."LASTACTIVITYDATE" >= (TIMESTAMP '2024-10-01 12:34:56' - INTERVAL '30' DAY)) AS "t5"
LEFT JOIN (SELECT "Posts1"."OwnerUserId" AS "OWNERUSERID", COUNT(*) AS "UPVOTES"
FROM "STACK"."Posts" AS "Posts1"
INNER JOIN "STACK"."Votes" ON "Posts1"."Id" = "Votes"."PostId" AND CAST("Votes"."VoteTypeId" AS INTEGER) = 2
GROUP BY "Posts1"."OwnerUserId") AS "t7" ON "t5"."OWNERUSERID" = "t7"."OWNERUSERID"
LEFT JOIN (SELECT "UserId" AS "USERID", COUNT(*) AS "CLOSEVOTES"
FROM "STACK"."PostHistory"
WHERE CAST("PostHistoryTypeId" AS INTEGER) = 10
GROUP BY "UserId") AS "t10" ON "t5"."OWNERUSERID" = "t10"."USERID"