SELECT COALESCE("t4"."DISPLAYNAME", "t4"."DISPLAYNAME") AS "DISPLAYNAME", "t4"."REPUTATION", COUNT("t6"."POSTID") AS "CLOSEDPOSTCOUNT", SUM(CASE WHEN "t6"."CLOSEDATE" >= (TIMESTAMP '2024-10-01 12:34:56' - INTERVAL '1' MONTH) THEN 1 ELSE 0 END) AS "RECENTCLOSEDPOSTS", LISTAGG(DISTINCT "t6"."TITLE", ', ') AS "CLOSEDPOSTTITLES"
FROM (SELECT "t"."DISPLAYNAME", "t"."REPUTATION", "t2"."POSTCOUNT", "t2"."TOTALVIEWS", "t2"."AVERAGESCORE"
FROM (SELECT "Id" AS "ID", "DisplayName" AS "DISPLAYNAME", "Reputation" AS "REPUTATION", ROW_NUMBER() OVER (ORDER BY "Reputation" DESC NULLS FIRST) AS "REPUTATIONRANK"
FROM "STACK"."Users") AS "t"
INNER JOIN (SELECT "OwnerUserId" AS "OWNERUSERID", COUNT(*) AS "POSTCOUNT", SUM("ViewCount") AS "TOTALVIEWS", AVG("Score") AS "AVERAGESCORE"
FROM "STACK"."Posts"
WHERE "CreationDate" >= (CAST('2024-10-01 12:34:56' AS TIMESTAMP(0)) - INTERVAL '1' YEAR)
GROUP BY "OwnerUserId") AS "t2" ON "t"."ID" = "t2"."OWNERUSERID"
WHERE "t"."REPUTATION" > 1000) AS "t4"
LEFT JOIN (SELECT "Posts0"."Id" AS "POSTID", "Posts0"."Title" AS "TITLE", "PostHistory"."UserDisplayName" AS "USERDISPLAYNAME", "PostHistory"."CreationDate" AS "CLOSEDATE"
FROM "STACK"."Posts" AS "Posts0"
INNER JOIN "STACK"."PostHistory" ON "Posts0"."Id" = "PostHistory"."PostId"
WHERE CAST("PostHistory"."PostHistoryTypeId" AS INTEGER) = 10) AS "t6" ON "t4"."DISPLAYNAME" = "t6"."USERDISPLAYNAME"
GROUP BY "t4"."DISPLAYNAME", "t4"."REPUTATION"