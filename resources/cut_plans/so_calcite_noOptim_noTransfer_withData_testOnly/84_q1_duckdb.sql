SELECT COALESCE("t3"."POSTID", "t3"."POSTID") AS "POSTID", "t3"."TITLE", "t3"."SCORE", "t3"."OWNERDISPLAYNAME", "t3"."CREATIONDATE", "t3"."COMMENTCOUNT", "t3"."ENGAGEMENTLEVEL", CASE WHEN "t5"."UPVOTES" IS NOT NULL THEN CAST("t5"."UPVOTES" AS INTEGER) ELSE 0 END AS "UPVOTES", CASE WHEN "t5"."DOWNVOTES" IS NOT NULL THEN CAST("t5"."DOWNVOTES" AS INTEGER) ELSE 0 END AS "DOWNVOTES"
FROM (SELECT "t0"."POSTID", "t0"."TITLE", "t0"."SCORE", "t0"."OWNERDISPLAYNAME", "t0"."CREATIONDATE", COUNT("Comments"."Id") AS "COMMENTCOUNT", CASE WHEN COUNT("Comments"."Id") > 10 THEN 'High Engagement    ' WHEN COUNT("Comments"."Id") >= 1 AND COUNT("Comments"."Id") <= 10 THEN 'Moderate Engagement' ELSE 'No Engagement      ' END AS "ENGAGEMENTLEVEL"
FROM (SELECT "Posts"."Id" AS "POSTID", "Posts"."Title" AS "TITLE", "Posts"."Score" AS "SCORE", "Users"."DisplayName" AS "OWNERDISPLAYNAME", "Posts"."CreationDate" AS "CREATIONDATE", ROW_NUMBER() OVER (PARTITION BY "Posts"."PostTypeId" ORDER BY "Posts"."CreationDate" DESC NULLS FIRST) AS "RN"
FROM "STACK"."Posts"
LEFT JOIN "STACK"."Users" ON "Posts"."OwnerUserId" = "Users"."Id"
WHERE "Posts"."CreationDate" >= (CAST('2024-10-01 12:34:56' AS TIMESTAMP(0)) - INTERVAL '1' YEAR) AND "Posts"."Score" > 0) AS "t0"
LEFT JOIN "STACK"."Comments" ON "t0"."POSTID" = "Comments"."PostId"
GROUP BY "t0"."POSTID", "t0"."TITLE", "t0"."SCORE", "t0"."OWNERDISPLAYNAME", "t0"."CREATIONDATE") AS "t3"
LEFT JOIN (SELECT "PostId" AS "POSTID", SUM(CASE WHEN CAST("VoteTypeId" AS INTEGER) = 2 THEN 1 ELSE 0 END) AS "UPVOTES", SUM(CASE WHEN CAST("VoteTypeId" AS INTEGER) = 3 THEN 1 ELSE 0 END) AS "DOWNVOTES"
FROM "STACK"."Votes"
GROUP BY "PostId") AS "t5" ON "t3"."POSTID" = "t5"."POSTID"
WHERE "t3"."ENGAGEMENTLEVEL" <> 'No Engagement'