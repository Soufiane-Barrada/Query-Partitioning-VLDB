SELECT COALESCE("C_CUSTKEY", "C_CUSTKEY") AS "C_CUSTKEY", "C_NAME", "CUSTOMER_TOTAL_SPENT", "TOTAL_ORDERS", "AVG_LINEITEM_PRICE", "LAST_ORDER_DATE"
FROM (SELECT "C_CUSTKEY", "C_NAME", SUM("FD_COL_2") AS "CUSTOMER_TOTAL_SPENT", COUNT(DISTINCT "o_orderkey") AS "TOTAL_ORDERS", AVG("l_extendedprice") AS "AVG_LINEITEM_PRICE", MAX("l_shipdate") AS "LAST_ORDER_DATE"
FROM "s1"
GROUP BY "C_CUSTKEY", "C_NAME"
ORDER BY 3 DESC NULLS FIRST) AS "t7"