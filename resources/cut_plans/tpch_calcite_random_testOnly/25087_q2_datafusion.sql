SELECT COALESCE("P_NAME", "P_NAME") AS "P_NAME", "S_NAME", "TOTAL_QUANTITY", "ORDER_COUNT", "AVERAGE_PRICE", "ORDER_DETAILS"
FROM (SELECT "P_NAME", "S_NAME", SUM("l_quantity") AS "TOTAL_QUANTITY", COUNT(DISTINCT "o_orderkey") AS "ORDER_COUNT", AVG("FD_COL_4") AS "AVERAGE_PRICE", LISTAGG(DISTINCT "FD_COL_5", "FD_COL_6") AS "ORDER_DETAILS"
FROM "s1"
GROUP BY "P_NAME", "S_NAME"
ORDER BY 3 DESC NULLS FIRST, 5 DESC NULLS FIRST) AS "t4"