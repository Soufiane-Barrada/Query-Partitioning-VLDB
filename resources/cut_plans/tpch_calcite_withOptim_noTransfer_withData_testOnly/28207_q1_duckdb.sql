SELECT COALESCE("t"."p_name", "t"."p_name") AS "P_NAME", "t"."s_name", "t"."ps_comment", "t"."p_comment", "t"."s_address", "t"."s_phone", ANY_VALUE(CONCAT('Supplier: ', "t"."s_name", ' | Comment: ', "t"."ps_comment")) AS "SUPPLIER_INFO", ANY_VALUE(REPLACE(REPLACE(LOWER("t"."p_comment"), ' ', '_'), '!', '')) AS "SANITIZED_COMMENT", ANY_VALUE(LENGTH("t"."p_name")) AS "NAME_LENGTH", ANY_VALUE(SUBSTRING("t"."s_address", 1, 20)) AS "SHORT_ADDRESS", ANY_VALUE(TRIM(BOTH ' ' FROM "t"."s_phone")) AS "FORMATTED_PHONE", COUNT(DISTINCT "orders"."o_orderkey") AS "ORDER_COUNT"
FROM (SELECT "part"."p_partkey", "part"."p_name", "part"."p_mfgr", "part"."p_brand", "part"."p_type", "part"."p_size", "part"."p_container", "part"."p_retailprice", "part"."p_comment", "partsupp"."ps_partkey", "partsupp"."ps_suppkey", "partsupp"."ps_availqty", "partsupp"."ps_supplycost", "partsupp"."ps_comment", "supplier"."s_suppkey", "supplier"."s_name", "supplier"."s_address", "supplier"."s_nationkey", "supplier"."s_phone", "supplier"."s_acctbal", "supplier"."s_comment", "lineitem"."l_orderkey", "lineitem"."l_partkey", "lineitem"."l_suppkey", "lineitem"."l_linenumber", "lineitem"."l_quantity", "lineitem"."l_extendedprice", "lineitem"."l_discount", "lineitem"."l_tax", "lineitem"."l_returnflag", "lineitem"."l_linestatus", "lineitem"."l_shipdate", "lineitem"."l_commitdate", "lineitem"."l_receiptdate", "lineitem"."l_shipinstruct", "lineitem"."l_shipmode", "lineitem"."l_comment"
FROM "TPCH"."lineitem"
RIGHT JOIN ("TPCH"."partsupp" INNER JOIN "TPCH"."supplier" ON "partsupp"."ps_suppkey" = "supplier"."s_suppkey" INNER JOIN "TPCH"."part" ON "partsupp"."ps_partkey" = "part"."p_partkey") ON "lineitem"."l_partkey" = "part"."p_partkey") AS "t"
LEFT JOIN "TPCH"."orders" ON "t"."l_orderkey" = "orders"."o_orderkey"
GROUP BY "t"."p_name", "t"."s_name", "t"."ps_comment", "t"."p_comment", "t"."s_address", "t"."s_phone"
HAVING COUNT(DISTINCT "orders"."o_orderkey") > 0